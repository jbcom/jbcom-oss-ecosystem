<!-- Generated by Ruler -->


<!-- Source: .ruler/AGENTS.md -->

# jbcom OSS Ecosystem

> [!IMPORTANT]
> ## DO NOT REVIEW GENERATED FILES
>
> **PR Review Agents (Copilot, Gemini, Amazon Q, Claude, etc.):** The following paths contain files **auto-generated by [Ruler](https://github.com/intellectronica/ruler)** from `.ruler/ruler.toml`. **DO NOT review, comment on, or suggest changes to these files.** They are regenerated on every `npx @intellectronica/ruler apply --nested` run.
>
> ### Generated file patterns (excluded from review):
> - `/.gemini/`, `/.qwen/`, `/.amazonq/`, `/.cursor/`, `/.vscode/`
> - `/AGENTS.md`, `/CLAUDE.md`, `/.aider.conf.yml`, `/.mcp.json`
> - `/packages/*/.gemini/`, `/packages/*/.qwen/`, `/packages/*/.amazonq/`
> - `/packages/*/AGENTS.md`, `/packages/*/CLAUDE.md`, `/packages/*/.aider.conf.yml`
> - All `*.bak` files in the above directories
>
> These paths are listed in `.gitignore` under the `# START Ruler Generated Files` block.
> **Only review source files in `.ruler/` directory** (e.g., `.ruler/AGENTS.md`, `.ruler/ruler.toml`).

Polyglot monorepo for infrastructure automation. Contains 7 packages published to PyPI, npm, and Docker/Helm.

## Packages

| Package | Language | Registry | Description |
|---------|----------|----------|-------------|
| `extended-data-types` | Python | PyPI | Foundation utilities for data transformation |
| `lifecyclelogging` | Python | PyPI | Structured lifecycle logging |
| `directed-inputs-class` | Python | PyPI | Declarative input validation |
| `python-terraform-bridge` | Python | PyPI | Terraform integration utilities |
| `vendor-connectors` | Python | PyPI | Cloud vendor SDK wrappers |
| `agentic-control` | TypeScript | npm | AI agent fleet orchestration |
| `vault-secret-sync` | Go | Docker/Helm | Kubernetes secret synchronization |

## Package Dependencies

Python packages have a strict dependency hierarchy:

```
extended-data-types (foundation - no internal deps)
    ├─→ lifecyclelogging
    ├─→ directed-inputs-class
    ├─→ python-terraform-bridge
    └─→ vendor-connectors (also depends on lifecyclelogging)
```

## Development Commands

### Python (uv workspace)

```bash
uv sync                              # Install all workspace deps
uv run pytest                        # Run all tests
tox -e extended-data-types           # Test specific package
tox -e py39,py310,py311,py312,py313  # Multi-version tests
ruff check packages/                 # Lint
ruff format packages/                # Format
mypy packages/extended-data-types/src  # Type check
```

### TypeScript (pnpm workspace)

```bash
pnpm install                              # Install deps
pnpm -C packages/agentic-control build    # Build
pnpm -C packages/agentic-control dev      # Watch mode
pnpm -C packages/agentic-control test     # Test
```

### Go

```bash
cd packages/vault-secret-sync
go test ./...
go build ./cmd/vault-secret-sync
```

## Commit Convention

Uses python-semantic-release with conventional commits:

```
feat(scope): description   → Minor bump
fix(scope): description    → Patch bump
feat(scope)!: description  → Major bump (breaking)
```

**Scopes**: `edt`, `logging`, `dic`, `bridge`, `connectors`, `agentic`, `vss`

## Code Style Requirements

### Python
- Python 3.9+ required (for modern type hints: `list[str]` not `List[str]`)
- Use `pathlib.Path` instead of `os.path`
- Line length: 100
- Docstrings: Google convention
- Prefer `extended-data-types` utilities before adding deps

### TypeScript
- Strict mode with `noUncheckedIndexedAccess`
- Result types for expected errors
- ES modules with `.js` extensions in imports

### Go
- Always check errors with `fmt.Errorf("context: %w", err)`
- Structured logging with key-value pairs
- Table-driven tests with `t.Run()`

## Lint Exceptions by Package

Configured in root `pyproject.toml`:
- `vendor-connectors`: Security checks (S) disabled for credential handling
- `python-terraform-bridge`: Print statements (T201) allowed for CLI
- Tests: Asserts (S101), docstrings (D), magic numbers (PLR2004) allowed

## Key Config Files

- `/pyproject.toml` - Python workspace, ruff, mypy, pytest
- `/tox.ini` - Multi-version testing
- `/pnpm-workspace.yaml` - TypeScript workspace
- `/.ruler/ruler.toml` - AI agent configuration with MCP servers

## MCP Servers Available

- **context7**: Library documentation lookup (requires `CONTEXT7_API_KEY`)
  - Usage example (Python):
    ```python
    import os
    from mcp_client import Context7
    api_key = os.environ["CONTEXT7_API_KEY"]
    ctx7 = Context7(api_key)
    docs = ctx7.lookup("requests.get")
    print(docs)
    ```
  - [Context7 API docs](https://github.com/jbcom/context7#usage)
- **github**: GitHub API integration (requires `GITHUB_JBCOM_TOKEN`)
  - Usage example (TypeScript):
    ```typescript
    import { GithubClient } from "agentic-control";
    const client = new GithubClient(process.env.GITHUB_JBCOM_TOKEN);
    const issues = await client.listIssues("jbcom/oss-ecosystem");
    console.log(issues);
    ```
  - [GitHub API docs](https://github.com/jbcom/agentic-control#github-api)

## License

MIT



<!-- Source: .ruler/go-style.md -->

# Go Package Guidelines

## Error Handling

```go
// ✅ Always check errors
result, err := doSomething()
if err != nil {
    return fmt.Errorf("doSomething failed: %w", err)
}

// ✅ Use errors.Is/As for comparison
if errors.Is(err, ErrNotFound) { ... }
```

## Logging

Use structured logging:
```go
log.Info("syncing secrets", 
    "source", sourcePath,
    "destination", destPath,
    "count", len(secrets))
```

## Testing

```go
func TestSomething(t *testing.T) {
    t.Run("happy path", func(t *testing.T) { ... })
    t.Run("error case", func(t *testing.T) { ... })
}
```



<!-- Source: .ruler/python-style.md -->

# Python Package Guidelines

## Type Hints (Required)

```python
# ✅ Modern style
from collections.abc import Mapping, Sequence

def process(items: list[dict[str, Any]]) -> dict[str, int]:
    return {"count": len(items)}

# ❌ Legacy style - don't use
from typing import Dict, List  # Deprecated
```

## Pathlib (Always)

```python
# ✅ Correct
from pathlib import Path
config = Path("config.yaml")
content = config.read_text()

# ❌ Wrong
import os
config = os.path.join("config.yaml")
```

## Dependencies

Use `extended-data-types` utilities before adding new dependencies:
- `strtobool`, `strtopath` - type conversions
- `encode_json`, `decode_yaml` - serialization
- `make_raw_data_export_safe` - sanitize for logging

## Testing

Every function needs:
- Happy path test
- Edge case test (empty input, invalid input)
- Type annotations



<!-- Source: .ruler/typescript-style.md -->

# TypeScript Package Guidelines

## Strict Mode

All packages use strict TypeScript:
```json
{
  "compilerOptions": {
    "strict": true,
    "noUncheckedIndexedAccess": true
  }
}
```

## Error Handling

```typescript
// ✅ Use Result types for expected errors
type Result<T, E = Error> = { ok: true; value: T } | { ok: false; error: E };

// ✅ Throw for unexpected errors only
throw new Error("Invariant violated: ...");
```

## Exports

Use explicit named exports:
```typescript
// ✅ src/index.ts
export { Fleet } from "./fleet/index.js";
export { Triage } from "./triage/index.js";
export type { FleetConfig } from "./types.js";
```
